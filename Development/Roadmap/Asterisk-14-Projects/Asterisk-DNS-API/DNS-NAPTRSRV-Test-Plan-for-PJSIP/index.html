<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://docs.asterisk.org/Development/Roadmap/Asterisk-14-Projects/Asterisk-DNS-API/DNS-NAPTRSRV-Test-Plan-for-PJSIP/ rel=canonical><link href=../ rel=prev><link href=../../RTP-engine-replacement/ rel=next><link rel=icon href=../../../../../favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.19"><title>DNS NAPTR/SRV Test Plan for PJSIP - Asterisk Documentation</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../material-override.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2ZKMCW9DZ9"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2ZKMCW9DZ9",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2ZKMCW9DZ9",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#srv-tests class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title="Asterisk Documentation" class="md-header__button md-logo" aria-label="Asterisk Documentation" data-md-component=logo> <img src=../../../../../favicon.ico alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Asterisk Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> DNS NAPTR/SRV Test Plan for PJSIP </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <table border=0 style="width: max-content;padding:0px;margin:0px"><tr><td> <a href=https://github.com/asterisk/asterisk title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> Asterisk </div> </a> </td> <td style=font-size:.65rem;line-height:1.2;vertical-align:middle;> <a href=/About-the-Project/Asterisk-Versions>Asterisk Versions</a><br> <a target=_blank href=https://github.com/asterisk/documentation/issues>Report Documentation Issues</a><br> <a target=_blank href=https://github.com/asterisk/documentation>Contribute to the Documentation</a> </td></tr> </table> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title="Asterisk Documentation" class="md-nav__button md-logo" aria-label="Asterisk Documentation" data-md-component=logo> <img src=../../../../../favicon.ico alt=logo> </a> Asterisk Documentation </label> <div class=md-nav__source> <table border=0 style="width: max-content;padding:0px;margin:0px"><tr><td> <a href=https://github.com/asterisk/asterisk title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> Asterisk </div> </a> </td> <td style=font-size:.65rem;line-height:1.2;vertical-align:middle;> <a href=/About-the-Project/Asterisk-Versions>Asterisk Versions</a><br> <a target=_blank href=https://github.com/asterisk/documentation/issues>Report Documentation Issues</a><br> <a target=_blank href=https://github.com/asterisk/documentation>Contribute to the Documentation</a> </td></tr> </table> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../About-the-Project/ class=md-nav__link> <span class=md-ellipsis> About the Project </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Asterisk-Community/ class=md-nav__link> <span class=md-ellipsis> Asterisk Community </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Fundamentals/ class=md-nav__link> <span class=md-ellipsis> Fundamentals </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Getting-Started/Beginning-Asterisk/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Configuration/Core-Configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Operation/ class=md-nav__link> <span class=md-ellipsis> Operation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8 checked> <div class="md-nav__link md-nav__container"> <a href=../../../../ class="md-nav__link "> <span class=md-ellipsis> Development </span> </a> <label class="md-nav__link " for=__nav_8 id=__nav_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=true> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../Policies-and-Procedures/ class=md-nav__link> <span class=md-ellipsis> Policies and Procedures </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../Debugging/ class=md-nav__link> <span class=md-ellipsis> Debugging </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../Reference-Information/ class=md-nav__link> <span class=md-ellipsis> Reference Information </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_5 checked> <div class="md-nav__link md-nav__container"> <a href=../../../ class="md-nav__link "> <span class=md-ellipsis> Roadmap </span> </a> <label class="md-nav__link " for=__nav_8_5 id=__nav_8_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_5_label aria-expanded=true> <label class=md-nav__title for=__nav_8_5> <span class="md-nav__icon md-icon"></span> Roadmap </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../AstriCon-2012-Presentations/ class=md-nav__link> <span class=md-ellipsis> AstriCon 2012 Presentations </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2010/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2010 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2011/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2011 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2012/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2012 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2013/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2013 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2014/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2014 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2015/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2015 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2016/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2016 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2017/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2017 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2022/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2022 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2024-December/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2024 December </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2024/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2024 </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2025-April/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2025 April </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon-2025-July/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2025 July </span> </a> </li> <li class=md-nav__item> <a href=../../../AstriDevCon/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon </span> </a> </li> <li class=md-nav__item> <a href=../../../Astricon-2021-Presentation-attachments/ class=md-nav__link> <span class=md-ellipsis> Astricon 2021 Presentation attachments </span> </a> </li> <li class=md-nav__item> <a href=../../../FOSDEM-2011-Open-Source-Telephony-Devroom/ class=md-nav__link> <span class=md-ellipsis> FOSDEM 2011 Open Source Telephony Devroom </span> </a> </li> <li class=md-nav__item> <a href=../../../OpenSIPit-2021/ class=md-nav__link> <span class=md-ellipsis> OpenSIPit 2021 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Asterisk-10-Projects/ class=md-nav__link> <span class=md-ellipsis> Asterisk 10 Projects </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Asterisk-11-Projects/ class=md-nav__link> <span class=md-ellipsis> Asterisk 11 Projects </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Asterisk-12-Projects/ class=md-nav__link> <span class=md-ellipsis> Asterisk 12 Projects </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Asterisk-13-Projects/ class=md-nav__link> <span class=md-ellipsis> Asterisk 13 Projects </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_5_24 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> Asterisk 14 Projects </span> </a> <label class="md-nav__link " for=__nav_8_5_24 id=__nav_8_5_24_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_8_5_24_label aria-expanded=true> <label class=md-nav__title for=__nav_8_5_24> <span class="md-nav__icon md-icon"></span> Asterisk 14 Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ARI-Feature-Wish-list/ class=md-nav__link> <span class=md-ellipsis> ARI Feature Wish-list </span> </a> </li> <li class=md-nav__item> <a href=../../Asterisk-14-Project-ARI-and-generic-Text-To-Speech/ class=md-nav__link> <span class=md-ellipsis> Asterisk 14 Project - ARI and generic Text To Speech </span> </a> </li> <li class=md-nav__item> <a href=../../Asterisk-14-Project-Media-Playlists/ class=md-nav__link> <span class=md-ellipsis> Asterisk 14 Project - Media Playlists </span> </a> </li> <li class=md-nav__item> <a href=../../Asterisk-14-Project-URI-Media-Playback/ class=md-nav__link> <span class=md-ellipsis> Asterisk 14 Project - URI Media Playback </span> </a> </li> <li class=md-nav__item> <a href=../../Asterisk-Beacon-Module/ class=md-nav__link> <span class=md-ellipsis> Asterisk Beacon Module </span> </a> </li> <li class=md-nav__item> <a href=../../Git-Migration/ class=md-nav__link> <span class=md-ellipsis> Git Migration </span> </a> </li> <li class=md-nav__item> <a href=../../Module-Loader-Ideas/ class=md-nav__link> <span class=md-ellipsis> Module Loader Ideas </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_5_24_9 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> Asterisk DNS API </span> </a> <label class="md-nav__link " for=__nav_8_5_24_9 id=__nav_8_5_24_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_8_5_24_9_label aria-expanded=true> <label class=md-nav__title for=__nav_8_5_24_9> <span class="md-nav__icon md-icon"></span> Asterisk DNS API </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> DNS NAPTR/SRV Test Plan for PJSIP </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> DNS NAPTR/SRV Test Plan for PJSIP </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#priority class=md-nav__link> <span class=md-ellipsis> Priority </span> </a> </li> <li class=md-nav__item> <a href=#failover-order class=md-nav__link> <span class=md-ellipsis> Failover order </span> </a> </li> <li class=md-nav__item> <a href=#failover-to-aaaaa class=md-nav__link> <span class=md-ellipsis> Failover to A/AAAA </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../RTP-engine-replacement/ class=md-nav__link> <span class=md-ellipsis> RTP engine replacement </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Asterisk-15-Projects/ class=md-nav__link> <span class=md-ellipsis> Asterisk 15 Projects </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Asterisk-16-Projects/ class=md-nav__link> <span class=md-ellipsis> Asterisk 16 Projects </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Asterisk-18-Projects/ class=md-nav__link> <span class=md-ellipsis> Asterisk 18 Projects </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Asterisk-19-Projects/ class=md-nav__link> <span class=md-ellipsis> Asterisk 19 Projects </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../AstriDevCon-2018/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2018 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../AstriDevCon-2019/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2019 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../AstriDevCon-2020/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2020 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../AstriDevCon-2021/ class=md-nav__link> <span class=md-ellipsis> AstriDevCon 2021 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Future-Potential-Project-Thoughts/ class=md-nav__link> <span class=md-ellipsis> Future Potential Project Thoughts </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../Asterisk-Bug-Bounties/ class=md-nav__link> <span class=md-ellipsis> Asterisk Bug Bounties </span> </a> </li> <li class=md-nav__item> <a href=../../../../Asterisk-C-API-Deprecations/ class=md-nav__link> <span class=md-ellipsis> Asterisk C API Deprecations </span> </a> </li> <li class=md-nav__item> <a href=../../../../Asterisk-Module-Deprecations/ class=md-nav__link> <span class=md-ellipsis> Asterisk Module Deprecations </span> </a> </li> <li class=md-nav__item> <a href=../../../../Asterisk-Open-Source-Maintainers/ class=md-nav__link> <span class=md-ellipsis> Asterisk Open Source Maintainers </span> </a> </li> <li class=md-nav__item> <a href=../../../../Open-Features-and-Improvements/ class=md-nav__link> <span class=md-ellipsis> Open Features and Improvements </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Latest_API/ class=md-nav__link> <span class=md-ellipsis> Latest API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Asterisk_16_Documentation/ class=md-nav__link> <span class=md-ellipsis> Asterisk 16 Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Asterisk_18_Documentation/ class=md-nav__link> <span class=md-ellipsis> Asterisk 18 Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Asterisk_19_Documentation/ class=md-nav__link> <span class=md-ellipsis> Asterisk 19 Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Asterisk_20_Documentation/ class=md-nav__link> <span class=md-ellipsis> Asterisk 20 Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Asterisk_21_Documentation/ class=md-nav__link> <span class=md-ellipsis> Asterisk 21 Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Asterisk_22_Documentation/ class=md-nav__link> <span class=md-ellipsis> Asterisk 22 Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Asterisk_23_Documentation/ class=md-nav__link> <span class=md-ellipsis> Asterisk 23 Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Certified-Asterisk_18.9_Documentation/ class=md-nav__link> <span class=md-ellipsis> Certified Asterisk 18.9 Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Certified-Asterisk_20.7_Documentation/ class=md-nav__link> <span class=md-ellipsis> Certified Asterisk 20.7 Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Test-Suite-Documentation/ class=md-nav__link> <span class=md-ellipsis> Test Suite Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../Historical-Documentation/ class=md-nav__link> <span class=md-ellipsis> Historical Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../../../Contributing-to-the-Documentation/ class=md-nav__link> <span class=md-ellipsis> Contributing to the Documentation </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#priority class=md-nav__link> <span class=md-ellipsis> Priority </span> </a> </li> <li class=md-nav__item> <a href=#failover-order class=md-nav__link> <span class=md-ellipsis> Failover order </span> </a> </li> <li class=md-nav__item> <a href=#failover-to-aaaaa class=md-nav__link> <span class=md-ellipsis> Failover to A/AAAA </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>WORK IN PROGRESS</p> </div> <p>At this stage in development, a resolver has been implemented, and backend support for NAPTR and SRV have been added. However, there are no users of NAPTR or (the new) SRV in Asterisk. The first user of them will be res_pjsip.so. In writing tests for res_pjsip, RFC 3263 will be the model for how SIP servers are to be located.</p> <div class="admonition info"> <p>For all of the following tests, we're assuming a scenario where the Asterisk testsuite is being used. Because of this, Asterisk and whatever remote endpoint is being looked up will reside on the same machine. Some of the processes in RFC 3263 require using port 5060 and 5061 as default ports for outbound lookups, so all of these tests should have SIP run on non-standard ports to avoid Asterisk sending requests to itself.</p> </div> <h1 id=srv-tests>SRV Tests<a class=headerlink href=#srv-tests title="Permanent link">&para;</a></h1> <h3 id=priority>Priority<a class=headerlink href=#priority title="Permanent link">&para;</a></h3> <p>Goal: To ensure that when multiple SRV records are returned, that records with the greatest priority (meaning smallest number) are chosen before others.</p> <p>Procedure:</p> <ul> <li>Set <code>_sip._udp.test.internal</code> to have the following records</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>;; Priority Weight Port Target
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>IN SRV 0 1 5060 main.test.internal.
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>IN SRV 1 1 5060 backup.test.internal.
</span></code></pre></div> * Disable NAPTR lookups for this test. Only allow UDP transport to be used. * Place an outbound SIP request to <code>sip:test.internal</code>. * Ensure that an SRV lookup of <code>_sip._udp.test.internal</code> is performed. * Ensure that this results in an A and/or AAAA lookup of <code>main.test.internal</code>.</p> <div class="admonition info"> <p>It is unknown whether the DNS engine in Asterisk will try to optimize by performing simultaneous lookups of both <code>main.test.internal</code> and <code>backup.test.internal</code> instead of going sequentially. If the domains are looked up in parallel, then this test cannot determine if the correct priority is being honored simply by monitoring A/AAAA record lookups. The test would have to be expanded in the following way:</p> <p>Add distinct A records for both <code>main.test.internal</code> and <code>backup.test.internal</code>. Ensure that the outgoing SIP request ends up being sent to the IP address retrieved from the A record lookup of <code>main.test.internal</code> and not the IP address retrieved by an A record lookup of <code>backup.test.internal</code></p> </div> <h3 id=failover-order>Failover order<a class=headerlink href=#failover-order title="Permanent link">&para;</a></h3> <p>Goal: To ensure that when returned SRV results fail, that the expected order for failing over is respected.</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>fast.test.internal IN A 127.0.0.1
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>slow.test.internal IN A 127.0.0.1
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>;; Priority Weight Port Target
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>_sip._udp.test.internal IN SRV 0 3 5061 fast.test.internal.
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a> IN SRV 0 1 5062 slow.test.internal.
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a> IN SRV 1 100 5063 backup.test.internal.
</span></code></pre></div> * Set up two SIPp scenarios + <code>fast.xml</code> runs at 127.0.0.1, port 5060. It expects an incoming INVITE and responds to the INVITE with a 503 response + <code>slow.xml</code> runs at 127.0.0.1, port 5061. It expects an incoming INVITE and does not respond to it * In Asterisk, disable NAPTR lookups. Enable only UDP as a transport. * Place an outbound call to <code>sip:test.internal</code>. * Ensure that an SRV lookup of <code>_sip._udp.test.internal</code> is performed. * Ensure that this results in an A lookup of either <code>fast.test.internal</code> or <code>slow.test.internal</code>. Since SRV weighting has a random factor to it, it is impossible to guarantee which of the two will be chosen first. * Ensure a SIP INVITE is sent to the chosen target * Ensure that upon failure of the call to the chosen target, that the remaining of fast or slow is chosen as the next target. * Ensure a SIP INVITE is sent to the new target. Ensure that the Via header (particularly the branch) is different from the previous outbound INVITE. * Ensure that upon failure of the second call, that backup is chosen as the next target. * When the A lookup of <code>backup.test.internal</code> returns NXDOMAIN, the test should conclude and not attempt any further lookups.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>RFC 3263 section 4.2 states:</p> <p>"If no SRV records were found, the client performs an A or AAAA record lookup of the domain name."</p> <p>My interpretation of this is that since we did find SRV records, we should not fail over to A/AAAA record lookups of <code>test.internal</code>. However, this may be an overly strict interpretation.</p> </div> <h3 id=failover-to-aaaaa>Failover to A/AAAA<a class=headerlink href=#failover-to-aaaaa title="Permanent link">&para;</a></h3> <p>Goal: Ensure that when SRV records are unavailable, that failover to A/AAAA is performed</p> <p>Procedure:</p> <ul> <li>Set up the following DNS record:</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>test.internal IN A 127.0.0.1
</span></code></pre></div> * Disable NAPTR lookups for this test. Only enable UDP as the transport. * Place an outbound call to <code>sip:test.internal</code> * Ensure that an SRV lookup of <code>_sip._udp.test.internal</code> is attempted. * Since there are no SRV records returned, ensure that the call fails over to an A/AAAA record lookup of <code>test.internal</code></p> <h1 id=naptr-tests>NAPTR Tests<a class=headerlink href=#naptr-tests title="Permanent link">&para;</a></h1> <p>NAPTR tests provided here are designed around the context of how SIP should be handling NAPTR lookups and their results.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The following NAPTR tests may have a flaw in them. From RFC 3263 section 4.1:</p> <p>'If a SIP proxy, redirect server, or registrar is to be contacted through the lookup of NAPTR records, there MUST be at least three records - one with a "SIP+D2T" service field, one with a "SIP+D2U" service field, and one with a "SIPS+D2T" service field.'</p> <p>Many of the NAPTR tests below do NOT have three records. The problems I have with this snippet are:</p> <ul> <li>It is not clear who this "MUST" language is directed to. Is this directed at nameservers that serve the NAPTR records, or is this aimed at SIP clients that look up the NAPTR records? My interpretation is that this restriction applies to those who are populating the DNS servers. We take the approach that as a SIP client, if not all three records exist, then we do not automatically consider the NAPTR lookup to have failed, and we will work with what we've been given.</li> <li>How are we supposed to know whether the entity we are contacting is a proxy, redirect server, or registrar? When sending a REGISTER, we might infer that we are contacting a registrar. For other types of requests, we have no idea what type of SIP entity we will be contacting. This reinforces my belief that this statement is directed towards the people that add the NAPTR records to DNS and that clients should be prepared to handle whatever SIP NAPTR records it gets from a lookup.</li> </ul> <p>So as far as these tests are concerned, since they involve placing outbound calls to simulated phones, we're technically not in violation by not providing the required three NAPTR records. But even if the tests were testing outbound registrations, the client behavior described in these tests would be the same, even if the required NAPTR records are not present in the lookup.</p> </div> <h2 id=nominal-tests>Nominal Tests<a class=headerlink href=#nominal-tests title="Permanent link">&para;</a></h2> <h3 id=correct-order>Correct Order<a class=headerlink href=#correct-order title="Permanent link">&para;</a></h3> <p>Goal: Ensure that when multiple NAPTR records are returned, that the record with the lowest order is used.</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records for <code>test.internal</code>:</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>; order pref flags service regexp replacement
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>IN NAPTR 50 50 &quot;s&quot; &quot;SIP+D2T&quot; &quot;&quot; _sip._tcp.test.internal.
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>IN NAPTR 90 40 &quot;s&quot; &quot;SIP+D2U&quot; &quot;&quot; _sip._udp.test.internal.
</span></code></pre></div> * Enable NAPTR lookups for outbound SIP calls. Allow both UDP and TCP transports to be used for the outgoing call. * Place an outbound SIP call to <code>sip:test.internal</code>. * Ensure that a NAPTR lookup of <code>test.internal</code> occurs * Ensure that the NAPTR lookup results in an SRV lookup of <code>_sip._tcp.test.internal</code></p> <h3 id=correct-preference>Correct Preference<a class=headerlink href=#correct-preference title="Permanent link">&para;</a></h3> <p>Goal: Ensure that when multiple NAPTR records with the same order are returned, that the one with the lowest preference is chosen first</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records for <code>test.internal</code>:</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>; order pref flags service regexp replacement
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>IN NAPTR 50 50 &quot;s&quot; &quot;SIP+D2T&quot; &quot;&quot; _sip._tcp.test.internal.
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>IN NAPTR 50 90 &quot;s&quot; &quot;SIP+D2U&quot; &quot;&quot; _sip._udp.test.internal.
</span></code></pre></div> * Enable NAPTR lookups for outbound SIP calls. Allow both UDP and TCP transports to be used for the outgoing call. * Place an outbound SIP call to <code>sip:test.internal</code> * Ensure that a NAPTR lookup of <code>test.internal</code> occurs * Ensure that an SRV lookup occurs for <code>_sip._tcp.test.internal</code></p> <div class="admonition info"> <p>It is unknown whether the DNS engine in Asterisk will try to optimize by performing simultaneous SRV lookups of both <code>_sip._tcp.test.internal</code> and <code>_sip._udp.test.internal</code> instead of going sequentially. If the domains are looked up in parallel, then this test cannot determine if the correct preference is being honored simply by monitoring SRV record lookups. The test would have to be expanded in the following way:</p> <p>Add distinct SRV records for <code>_sip._tcp.test.internal</code> and <code>_sip._udp.test.internal</code>. Each of the domains pointed to by those SRV records should be distinct A records. Ensure that the outgoing SIP request ends up being sent to the IP address retrieved from the A record lookup of the domain pointed to by the <code>_sip._tcp.test.internal</code> SRV record.</p> </div> <h3 id=restricted-transport>Restricted Transport<a class=headerlink href=#restricted-transport title="Permanent link">&para;</a></h3> <p>Goal: Ensure that an appropriate NAPTR record is chosen based on the configured transports.</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records for <code>test.internal</code>:</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>; order pref flags service regexp replacement
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>IN NAPTR 50 50 &quot;s&quot; &quot;SIP+D2T&quot; &quot;&quot; _sip._tcp.test.internal.
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>IN NAPTR 60 50 &quot;s&quot; &quot;SIP+D2U&quot; &quot;&quot; _sip._udp.test.internal.
</span></code></pre></div> * Enable NAPTR lookups for outbound SIP calls. Only allow UDP to be used for the outgoing call. * Place an outbound call to <code>sip:test.internal</code> * Ensure that a NAPTR lookup of <code>test.internal</code> occurs * Ensure that the NAPTR lookup results in an SRV for <code>_sip._udp.test.internal</code> and no SRV lookup occurs for <code>_sip._tcp.test.internal</code></p> <h3 id=failover-of-preferences>Failover of preferences<a class=headerlink href=#failover-of-preferences title="Permanent link">&para;</a></h3> <p>Goal: Ensure that failover occurs between NAPTR records of the same order</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records for <code>test.internal</code>:</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>test.internal IN NAPTR 50 50 &quot;s&quot; &quot;SIP+D2T&quot; &quot;&quot; _sip._tcp.test.internal.
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a> IN NAPTR 50 60 &quot;s&quot; &quot;SIP+D2U&quot; &quot;&quot; _sip._udp.test.internal.
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>_sip._udp.test.internal IN SRV 1 1 5060 sip.test.internal
</span></code></pre></div> * Enable NAPTR lookups for outbound SIP calls. Allow both UDP and TCP to be used for the outgoing call. * Place an outbound call to <code>sip:test.internal</code> * Ensure that a NAPTR lookup of <code>test.internal</code> occurs. * Ensure that the NAPTR lookup results in an SRV lookup for <code>_sip._tcp.test.internal</code>. * Ensure that the SRV lookup fails. * Ensure that an SRV lookup then occurs for <code>_sip._udp.test.internal</code></p> <h2 id=off-nominal-tests>Off-nominal tests<a class=headerlink href=#off-nominal-tests title="Permanent link">&para;</a></h2> <p>Off-nominal tests are designed to detect NAPTR records that are correct by the core definition of NAPTR but erroneous in the context of SIP.</p> <h3 id=no-naptr>No NAPTR<a class=headerlink href=#no-naptr title="Permanent link">&para;</a></h3> <p>Goal: To ensure that if no NAPTR records are configured on the DNS server that we fail over to SRV lookups instead.</p> <ul> <li>Set up no NAPTR records for <code>test.internal</code></li> <li>Enable NAPTR lookups for outbound SIP calls. Enable TCP, UDP, and TLS transports to be used.</li> <li>Place an outbound call to <code>sip:test.internal</code></li> <li>Ensure that a NAPTR lookup is performed for <code>test.internal</code></li> <li>Ensure that lookups for <code>_sips._tcp.test.internal</code>, <code>_sip.tcp.test.internal</code>, and <code>_sip._udp.test.internal</code> are performed.</li> </ul> <h3 id=no-sip-services>No SIP services<a class=headerlink href=#no-sip-services title="Permanent link">&para;</a></h3> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This test is based on an interpretation of RFC 3263 section 4.1:</p> <p>"If no NAPTR records are found, the client constructs SRV queries for those transport protocols it supports, and does a query for each."</p> <p>My interpretation of "no NAPTR records are found" can mean either that there are no NAPTR records at all OR that there are NAPTR records but not for SIP services.</p> </div> <p>Goal: To ensure that if a NAPTR lookup gives no recognized SIP services, that we fail over to an SRV lookup instead.</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records for <code>test.internal</code> (taken from RFC 3403):</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>;; order pref flags service regexp replacement
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>IN NAPTR 100 50 &quot;a&quot; &quot;z3950+N2L+N2C&quot; &quot;&quot; cidserver.test.internal.
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>IN NAPTR 100 50 &quot;a&quot; &quot;rcds+N2C&quot; &quot;&quot; cidserver.test.internal.
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>IN NAPTR 100 50 &quot;s&quot; &quot;http+N2L+N2C+N2R&quot; &quot;&quot; www.test.internal.
</span></code></pre></div> * Enable NAPTR lookups for outbound SIP calls. Enable TCP, UDP, and TLS transports to be used. * Place an outbound call to <code>sip:test.internal</code> * Ensure that none of the returned NAPTR records are used for further lookups. * Ensure that SRV lookups are performed for <code>_sip._tcp.test.internal</code>, <code>_sips._tcp.test.internal</code>, and <code>_sip._udp.test.internal</code>.</p> <h3 id=no-compatible-sip-services>No Compatible SIP services<a class=headerlink href=#no-compatible-sip-services title="Permanent link">&para;</a></h3> <p>Goal: To ensure that if SIP NAPTR records are returned for incompatible services, that we fail over to an SRV lookup instead.</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records for <code>test.internal</code>:</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>; order pref flags service regexp replacement
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>IN NAPTR 50 50 &quot;s&quot; &quot;SIPS+D2T&quot; &quot;&quot; _sips._tcp.test.internal.
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>IN NAPTR 60 50 &quot;s&quot; &quot;SIP+D2T&quot; &quot;&quot; _sip._tcp.test.internal.
</span></code></pre></div> * Enable NAPTR lookups for outbound SIP calls. Enable only UDP transport to be used. * Place an outbound call to <code>sip:test.internal</code> * Ensure that none of the returned NAPTR records are used for further lookups. * Ensure that an SRV lookup is performed for <code>_sip._udp.test.internal</code></p> <h3 id=non-s-flag-in-sip-record>Non-"S" flag in SIP record<a class=headerlink href=#non-s-flag-in-sip-record title="Permanent link">&para;</a></h3> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This test is based around the following text in RFC 3263 section 4.1:</p> <p>"These NAPTR records provide a mapping from a domain to the SRV record for contacting a server with the specific transport protocol in the NAPTR services field"</p> <p>My interpretation of this is that NAPTR records for SIP services MUST have the "s" flag set, and any records with other flags set are not compatible with RFC 3263</p> </div> <p>Goal: To ensure that only NAPTR records which indicate SRV lookups are considered.</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records for <code>test.internal</code>:</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>; order pref flags service regexp replacement
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>IN NAPTR 50 50 &quot;a&quot; &quot;SIP+D2T&quot; &quot;&quot; sip.tcp.test.internal.
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>IN NAPTR 60 50 &quot;s&quot; &quot;SIP+D2T&quot; &quot;&quot; _sip._tcp.test.internal.
</span></code></pre></div> * Enable NAPTR lookups for outbound SIP calls. Enable UDP, TCP, and TLS transports to be used. * Place an outbound call to <code>sip:test.internal</code> * Ensure that an SRV lookup is performed for <code>_sip._tcp.test.internal</code>, and no A or AAAA lookup is performed for <code>sip.tcp.test.internal</code>.</p> <h3 id=regexp-in-sip-record>Regexp in SIP record<a class=headerlink href=#regexp-in-sip-record title="Permanent link">&para;</a></h3> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This test is based around the following text from RFC 3263 section 4.1:</p> <p>"The resource record will contain an empty regular expression and a replacement value, which is the SRV record for that particular transport protocol"</p> <p>My interpretation is that NAPTR records for SIP services MUST NOT have regular expressions in them. Records that have regular expressions are ignored.</p> </div> <p>Goal: Ensure that only NAPTR records without regular expressions are processed</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records for <code>test.internal</code>:</li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>; order pref flags service regexp replacement
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>IN NAPTR 50 50 &quot;s&quot; &quot;SIP+D2T&quot; &quot;!.*!_sip._tcp.test.internal!&quot; .
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>IN NAPTR 60 50 &quot;s&quot; &quot;SIP+D2U&quot; &quot;&quot; _sip._udp.test.internal.
</span></code></pre></div> * Enable NAPTR lookups for outbound SIP calls. Enable UDP, TCP, and TLS transports to be used. * Place an outbound call to <code>sip:test.internal</code> * Ensure that an SRV lookup is performed for <code>_sip._udp.test.internal</code>, and no other SRV lookups are performed.</p> <h3 id=no-failover-of-order>No Failover of Order<a class=headerlink href=#no-failover-of-order title="Permanent link">&para;</a></h3> <p>Goal: Ensure that no processing of NAPTR records occurs for higher order values than the first record processed (grammar ftw).</p> <p>Procedure:</p> <ul> <li>Set up the following DNS records:</li> </ul> <div class="language-text highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>test.internal IN NAPTR 50 50 &quot;s&quot; &quot;SIP+D2T&quot; &quot;&quot; _sip._tcp.test.internal.
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a> IN NAPTR 60 50 &quot;s&quot; &quot;SIP+D2U&quot; &quot;&quot; _sip._udp.test.internal.
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>_sip._udp.test.internal IN SRV 1 1 5060 sip.test.internal
</span></code></pre></div> <p>Note that there is no SRV record for <code>_sip._tcp.test.internal</code> * Enable NAPTR lookups for outbound SIP calls. Enable UDP and TCP transports to be used. * Place an outbound call to <code>sip:test.internal</code> * Ensure that an SRV lookup is performed for <code>_sip._tcp.test.internal</code>. * When the SRV lookup fails, ensure that no other SRV lookups are attempted.</p> <h1 id=other-rfc-3263-related-tests>Other RFC 3263-related Tests<a class=headerlink href=#other-rfc-3263-related-tests title="Permanent link">&para;</a></h1> <p>The majority of these tests rely on using the proper lookup method based on the construction of the URI.</p> <h3 id=sip-uri-extravaganza>SIP URI Extravaganza<a class=headerlink href=#sip-uri-extravaganza title="Permanent link">&para;</a></h3> <p>This is a mega-test that will require many sub-tests. The following DNS entries will be needed for the test:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>; NAPTR records
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>test.internal IN NAPTR 50 50 &quot;s&quot; &quot;SIPS+D2T&quot; &quot;&quot; _sips._tcp.test.internal.
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a> IN NAPTR 60 50 &quot;s&quot; &quot;SIP+D2T&quot; &quot;&quot; _sip._tcp.test.internal.
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a> IN NAPTR 90 50 &quot;s&quot; &quot;SIP+D2U&quot; &quot;&quot; _sip._udp.test.internal.
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>; SRV records
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>_sips._tcp.test.internal IN SRV 0 100 5061 tls.test.internal.
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>_sip._tcp.test.internal IN SRV 0 100 5060 tcp.test.internal.
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>_sip._udp.test.internal IN SRV 0 100 5060 udp.test.internal.
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>; A/AAAA records
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>tls.test.internal IN A 127.0.0.1
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a> IN AAAA ::1
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>tcp.test.internal IN A 127.0.0.1
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a> IN AAAA ::1
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>udp.test.internal IN A 127.0.0.1
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a> IN AAAA ::1
</span></code></pre></div> <p>The parts of a SIP URI can be used to determine what transport should be used and/or what type of lookup should be used. Consult the following table</p> <table> <thead> <tr> <th></th> <th>Numeric host</th> <th>Numeric host with port</th> <th>Non-numeric host</th> <th>Non-numeric host with port</th> </tr> </thead> <tbody> <tr> <td>;transport=tls</td> <td>Transport: TLSLookup: nonePort: 5061</td> <td>Transport: TLSLookup: nonePort: As specified</td> <td>Transport: TLSLookup: SRV <code>_sips._tcp.&lt;domain&gt;</code>Port: Determined by lookup</td> <td>Transport: TLSLookup: A/AAAAPort: As specified</td> </tr> <tr> <td>;transport=tcp</td> <td>Transport: TCPLookup: nonePort: 5060</td> <td>Transport: TCPLookup: nonePort: As specified</td> <td>Transport: TCPLookup: SRV <code>_sip._tcp.&lt;domain&gt;</code>Port: Determined by lookup</td> <td>Transport: TCPLookup: A/AAAAPort: As specified</td> </tr> <tr> <td>;transport=udp</td> <td>Transport: UDPLookup: nonePort: 5060</td> <td>Transport: UDPLookup: nonePort: As specified</td> <td>Transport: UDPLookup: SRV <code>_sip._udp.&lt;domain&gt;</code>Port: Determined by lookup</td> <td>Transport: UDPLookup: A/AAAAPort: As specified</td> </tr> <tr> <td>No transport</td> <td>Transport: UDPLookup: nonePort: 5060</td> <td>Transport: UDPLookup: nonePort: As specified</td> <td>Transport: Determined by lookupLookup: NAPTRPort: Determined by lookup</td> <td>Transport: UDPLookup: A/AAAAPort: As specified</td> </tr> <tr> <td>SIPS URI</td> <td>Transport: TLSLookup: nonePort: 5061</td> <td>Transport: TLSLookup: nonePort: As specified</td> <td>Transport: TLSLookup: NAPTRPort: Determined by lookup</td> <td>Transport: TLSLookup: A/AAAAPort: As specified</td> </tr> </tbody> </table> <p>Goal: Ensure that SIP URIs of different construction result in proper lookups being carried out.</p> <p>Procedure:</p> <ul> <li>Construct 20 SIP URIs such that each satisfies a unique row/column combination in the above table. The domain used for all URIs should be <code>test.internal</code>. If the column says to include a port, use 5060 as the explicit port unless the transport is TLS. If the transport in the cell is TLS, then use port 5061.</li> <li>For each URI:<ul> <li>Place an outbound call to that URI</li> <li>Ensure that if a lookup should be done that the correct one is performed. If no lookup is required, ensure none is performed.</li> <li>Ensure that the outbound SIP request is sent to the proper place as dictated by the table. The proper destination may require several DNS lookups to determine.</li> </ul> </li> </ul> <h3 id=sip-uri-with-username>SIP URI with username<a class=headerlink href=#sip-uri-with-username title="Permanent link">&para;</a></h3> <p>Goal: Ensure that the username portion of a SIP username is not included in any NAPTR or SRV lookups.</p> <p>Procedure:</p> <ul> <li>Place a call to <code>sip:alice@test.internal</code></li> <li>Ensure that this results in a NAPTR lookup of <code>test.internal</code> and not a NAPTR lookup of <code>alice@test.internal</code></li> </ul> <h3 id=sip-uri-with-maddr>SIP URI with maddr<a class=headerlink href=#sip-uri-with-maddr title="Permanent link">&para;</a></h3> <p>Goal: Ensure that the maddr URI parameter is used instead of the URI host if present</p> <p>Procedure:</p> <ul> <li>Place a call to <code>sip:test.internal;maddr=mtest.internal</code></li> <li>Ensure that a NAPTR lookup of <code>mtest.internal</code> is performed and not a NAPTR lookup of <code>test.internal</code></li> </ul> <h3 id=sip-aaaaa-failover>SIP A/AAAA failover<a class=headerlink href=#sip-aaaaa-failover title="Permanent link">&para;</a></h3> <p>Goal: Ensure that when multiple A or AAAA records are returned, failover between records occurs.</p> <p>Procedure:</p> <ul> <li>Set up the following records for <code>test.internal</code></li> </ul> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>main.test.internal IN A 127.0.0.1
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a> IN AAAA ::1
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>;; Priority Weight Port Target
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>_sip._udp.test.internal IN SRV 0 100 5060 main.test.internal.
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a> IN SRV 1 100 5060 backup.test.internal.
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>test.internal IN NAPTR 0 0 &quot;s&quot; &quot;SIP+D2U&quot; &quot;&quot; _sip._udp.test.internal
</span></code></pre></div> * Place a call to <code>sip:test.internal</code> * Ensure that a NAPTR lookup is performed for <code>test.internal</code> * Ensure that an SRV lookup is performed for <code>_sip._udp.test.internal</code> * Ensure that an A and AAAA lookup is performed for <code>main.test.internal</code>. It is unknown which of the two records for <code>main.test.internal</code> will be returned first. However, since neither actually has anything running on them, either should work fine. * Ensure that when the SIP request to the first returned record from <code>main.test.internal</code> fails (due to transaction timeout due to no response), that the second record from <code>main.test.internal</code> is attempted before performing any lookup on <code>backup.test.internal</code></p> <h3 id=response-via-header-extravaganza>Response Via header extravaganza<a class=headerlink href=#response-via-header-extravaganza title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th></th> <th>Numeric sent-by</th> <th>Non-numeric sent-by</th> </tr> </thead> <tbody> <tr> <td>Port present</td> <td>Lookup: NonePort: As specified</td> <td>Lookup: A/AAAAPort: As specified</td> </tr> <tr> <td>Port not present</td> <td>Lookup: NonePort: Default (5060 for UDP and TCP, 5061 for TLS)</td> <td>Lookup: SRV*Port: Determined by lookup</td> </tr> </tbody> </table> <ul> <li> <p>The SRV lookups are as follows:</p> </li> <li> <p>UDP: <code>_sip._udp.&lt;domain&gt;</code></p> </li> <li>TCP: <code>_sip._tcp.&lt;domain&gt;</code></li> <li>TLS: <code>_sips._tcp.&lt;domain&gt;</code></li> </ul> <p>Goal: Ensure that SIP responses are sent to the correct location given different types of Via headers</p> <p>Procedure:</p> <ul> <li>Set up a series of SIPp scenarios that will send an INVITE and then immediately end. Each scenario should use a Via that satisfies one of the cells in the above table. There should be scenarios for UDP, TCP, and TLS, meaning there should be a total of 12 scenarios. For scenarios that use a non-numeric sent-by, use <code>test.internal</code>. For tests that require a port to be present in the sent-by, use 5060 for UDP and TCP, and use 5061 for TLS.</li> <li>Run each scenario. Ensure that Asterisk initially attempts to use the appropriate destination for the response<ul> <li>For UDP, this will be the sender's source address</li> <li>For TCP/TLS, this will use the connection that the incoming request arrived on.</li> </ul> </li> <li>Ensure that the initial attempt to send the response fails.</li> <li>Ensure that after the failure, the appropriate lookup is performed, and that the response is tried again using the data retrieved from the lookup.</li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Content is licensed under a Creative Commons Attribution-ShareAlike 3.0 United States License. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.asterisk.org/ target=_blank rel=noopener title=www.asterisk.org class=md-social__link> <?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg version=1.1 id=svg2 width=48 height=48 viewbox="0 0 48 48" sodipodi:docname=favicon.svg inkscape:version="1.2.2 (b0a8486541, 2022-12-01)" xmlns:inkscape=http://www.inkscape.org/namespaces/inkscape xmlns:sodipodi=http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd xmlns:xlink=http://www.w3.org/1999/xlink xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg> <defs id=defs6 /> <sodipodi:namedview id=namedview4 pagecolor=#ffffff bordercolor=#666666 borderopacity=1.0 inkscape:showpageshadow=2 inkscape:pageopacity=0.0 inkscape:pagecheckerboard=0 inkscape:deskcolor=#d1d1d1 showgrid=false inkscape:zoom=17.291667 inkscape:cx=24 inkscape:cy=24.028916 inkscape:current-layer=g8 /> <g inkscape:groupmode=layer inkscape:label=Image id=g8> <image width=48 height=48 preserveaspectratio=none id=image10 xlink:href="data:image/png;base64,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
"/> </g> </svg> </a> <a href=https://www.asterisk.org/blog/ target=_blank rel=noopener title=www.asterisk.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="m61.7 169.4 101.5 278C92.2 413 43.3 340.2 43.3 256c0-30.9 6.6-60.1 18.4-86.6m337.9 75.9c0-26.3-9.4-44.5-17.5-58.7-10.8-17.5-20.9-32.4-20.9-49.9 0-19.6 14.8-37.8 35.7-37.8.9 0 1.8.1 2.8.2-37.9-34.7-88.3-55.9-143.7-55.9-74.3 0-139.7 38.1-177.8 95.9 5 .2 9.7.3 13.7.3 22.2 0 56.7-2.7 56.7-2.7 11.5-.7 12.8 16.2 1.4 17.5 0 0-11.5 1.3-24.3 2l77.5 230.4L249.8 247l-33.1-90.8c-11.5-.7-22.3-2-22.3-2-11.5-.7-10.1-18.2 1.3-17.5 0 0 35.1 2.7 56 2.7 22.2 0 56.7-2.7 56.7-2.7 11.5-.7 12.8 16.2 1.4 17.5 0 0-11.5 1.3-24.3 2l76.9 228.7 21.2-70.9c9-29.4 16-50.5 16-68.7m-139.9 29.3-63.8 185.5c19.1 5.6 39.2 8.7 60.1 8.7 24.8 0 48.5-4.3 70.6-12.1-.6-.9-1.1-1.9-1.5-2.9zm183-120.7c.9 6.8 1.4 14 1.4 21.9 0 21.6-4 45.8-16.2 76.2l-65 187.9C426.2 403 468.7 334.5 468.7 256c0-37-9.4-71.8-26-102.1M8 256a248 248 0 1 1 496 0 248 248 0 1 1-496 0m484.6 0a236.6 236.6 0 1 0-473.2 0 236.6 236.6 0 1 0 473.2 0"/></svg> </a> <a href=https://twitter.com/asteriskdev target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> <a href=https://github.com/asterisk target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://community.asterisk.org target=_blank rel=noopener title=community.asterisk.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M225.9 32C103.3 32 0 130.5 0 252.1 0 256 .1 480 .1 480l225.8-.2c122.7 0 222.1-102.3 222.1-223.9S348.6 32 225.9 32M224 384c-19.4 0-37.9-4.3-54.4-12.1L88.5 392l22.9-75c-9.8-18.1-15.4-38.9-15.4-61 0-70.7 57.3-128 128-128s128 57.3 128 128-57.3 128-128 128"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.prune", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../../../assets/javascripts/bundle.92b07e13.min.js></script> </body> </html>